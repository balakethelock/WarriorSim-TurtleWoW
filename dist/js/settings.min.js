var SIM=SIM||{};SIM.SETTINGS={init:function(){this.variables(),this.events(),this.buildSpells(),this.buildBuffs(),this.buildTalents()},variables:function(){this.body=$("body"),this.buffs=this.body.find("article.buffs"),this.fight=this.body.find("article.fight"),this.rotation=this.body.find("article.rotation"),this.talents=this.body.find("article.talents"),this.filter=this.body.find("article.filter"),this.close=this.body.find("section.settings .btn-close"),this.bg=this.body.find("section.sidebar .bg")},events:function(){var e=this;e.close.click(function(e){e.preventDefault(),$(".js-settings").removeClass("active"),$("section.settings").removeClass("active")}),e.buffs.on("click",".icon",function(t){let i=$(this).toggleClass("active");i.hasClass("active")&&(i.data("group")&&i.siblings().filter('[data-group="'+i.data("group")+'"]').removeClass("active"),i.data("disable-spell")&&$('.rotation [data-id="'+i.data("disable-spell")+'"]').removeClass("active"));for(let t of buffs)t.active=e.buffs.find('[data-id="'+t.id+'"]').hasClass("active");t.stopPropagation(),t.preventDefault(),SIM.UI.updateSession(),SIM.UI.updateSidebar()}),e.talents.on("click",".icon",function(t){let i=e.getTalent($(this));i.c=i.c<i.m?i.c+1:i.m,$(this).attr("data-count",i.c),i.c>=i.m&&$(this).addClass("maxed"),i.enable&&$('.rotation [data-id="'+i.enable+'"]').removeClass("hidden"),$(this).find("a").attr("href","https://database.turtle-wow.org/?spell="+i.s[0==i.c?0:i.c-1]),SIM.UI.updateSession(),SIM.UI.updateSidebar()}),e.talents.on("contextmenu",".icon",function(t){t.preventDefault();let i=e.getTalent($(this));if(i.c=i.c<1?0:i.c-1,$(this).attr("data-count",i.c),$(this).removeClass("maxed"),0==i.c&&i.enable){$('.rotation [data-id="'+i.enable+'"]').removeClass("active").addClass("hidden");for(let e of spells)e.id==i.enable&&(e.active=!1)}$(this).find("a").attr("href","https://database.turtle-wow.org/?spell="+i.s[0==i.c?0:i.c-1]),SIM.UI.updateSession(),SIM.UI.updateSidebar()}),e.filter.on("click",".sources > li",function(e){$(this).toggleClass("active"),SIM.UI.updateSession(),SIM.UI.filterGear(),e.preventDefault()}),e.filter.on("click",".js-toggle, li ul",function(e){if(e.stopPropagation(),this.classList.contains("js-toggle")){var t=this.getAttribute("data-id");$("."+t).toggleClass("hidden")}}),e.filter.on("click",".phases li",function(t){$(this).toggleClass("active");let i=$(this).data("sources").split(","),a=$(this).hasClass("active");for(let t of i)a?e.filter.find('.sources [data-id="'+t+'"]').addClass("active"):e.filter.find('.sources [data-id="'+t+'"]').removeClass("active");SIM.UI.updateSession(),SIM.UI.filterGear()}),e.rotation.on("click",".spell",function(e){let t=e.target;if("LI"==t.nodeName||"INPUT"==t.nodeName)return;$(this).toggleClass("active");let i=$(this).data("id");for(let e of spells)e.id==i&&(e.active=$(this).hasClass("active"));SIM.UI.updateSession()}),e.rotation.on("keyup",'input[type="text"]',function(e){let t=$(this).parents(".spell").data("id");for(let e of spells)e.id==t&&(e[$(this).attr("name")]=$(this).val());SIM.UI.updateSession()}),e.buffs.on("click","label",function(e){$(this.parentElement).find("div").toggleClass("hidden"),SIM.SETTINGS.toggleArticle(this)}),e.fight.on("click","label",function(e){$(this.parentElement).find("ul").toggleClass("hidden"),SIM.SETTINGS.toggleArticle(this)}),e.rotation.on("click","label",function(e){$(this.parentElement).find("div:first").toggleClass("hidden"),SIM.SETTINGS.toggleArticle(this)}),e.talents.on("click","label",function(e){$(this.parentElement).find("table").toggleClass("hidden"),SIM.SETTINGS.toggleArticle(this)}),e.filter.on("click","label",function(e){$(this.parentElement).find("ul").toggleClass("hidden"),SIM.SETTINGS.toggleArticle(this)}),e.fight.on("change",'select[name="race"]',function(t){var i=$(this).val(),a=e.rotation.find('[data-id="20572"]'),n=e.rotation.find('[data-id="26296"]'),s=[];"Orc"==i?a.removeClass("hidden"):(a.addClass("hidden").removeClass("active"),s.push(20572)),"Troll"==i?n.removeClass("hidden"):(n.addClass("hidden").removeClass("active"),s.push(26296));for(let e of spells)s.includes(e.id)&&(e.active=!1);e.bg.attr("data-race",i),t.stopPropagation(),SIM.UI.updateSession(),SIM.UI.updateSidebar()}),e.fight.on("change",'select[name="targetlevel"]',function(e){e.stopPropagation(),SIM.UI.updateSession(),SIM.UI.updateSidebar()}),e.fight.on("change",'select[name="aqbooks"]',function(e){e.stopPropagation(),SIM.UI.updateSession(),SIM.UI.updateSidebar()}),e.fight.on("keyup",'input[type="text"]',function(e){e.stopPropagation(),SIM.UI.updateSession(),SIM.UI.updateSidebar()}),e.fight.on("change",'select[name="weaponrng"]',function(e){e.stopPropagation(),SIM.UI.updateSession(),SIM.UI.updateSidebar()}),e.fight.on("change",'select[name="batching"]',function(e){e.stopPropagation(),SIM.UI.updateSession(),SIM.UI.updateSidebar()})},toggleArticle:function(e){e.classList.contains("active")?(e.classList.add("inactive"),e.classList.remove("active")):(e.classList.add("active"),e.classList.remove("inactive"))},buildSpells:function(){for(let e of spells){let t=115671==e.id?11567:e.id,i=$(`<div data-id="${e.id}" class="spell"><div class="icon">\n            <img src="dist/img/${e.iconname.toLowerCase()}.jpg " alt="${e.name}">\n            <a href="https://database.turtle-wow.org/?spell=${t}" class="wh-tooltip"></a>\n            </div><ul class="options"></ul></div>`);void 0!==e.timetoend&&i.find(".options").append(`<li>Use on last <input type="text" name="timetoend" value="${e.timetoend}" data-numberonly="true" /> seconds</li>`),void 0!==e.minrage&&i.find(".options").append(`<li>Use when above <input type="text" name="minrage" value="${e.minrage}" data-numberonly="true" /> rage</li>`),void 0!==e.maxrage&&i.find(".options").append(`<li>Use when below <input type="text" name="maxrage" value="${e.maxrage}" data-numberonly="true" /> rage</li>`),void 0!==e.globals&&i.find(".options").append(`<li>Use on first <input type="text" name="globals" value="${e.globals}" data-numberonly="true" /> globals</li>`),void 0!==e.maincd&&i.find(".options").append(`<li>BT/MS cooldown >= <input type="text" name="maincd" value="${e.maincd}" data-numberonly="true" /> secs</li>`),void 0!==e.crusaders&&i.find(".options").append(`<li>when <input type="text" name="crusaders" value="${e.crusaders}" data-numberonly="true" /> crusaders are up</li>`),void 0!==e.haste&&i.find(".options").append(`<li>Attack speed at <input type="text" name="haste" value="${e.haste}" data-numberonly="true" /> %</li>`),void 0!==e.priorityap&&i.find(".options").append(`<li>Prioritize BT/MS when >= <input style="width:25px" type="text" name="priorityap" value="${e.priorityap}" data-numberonly="true" /> AP</li>`),23255==e.id&&i.find(".options").append("<li>Include Deep Wounds damage</li>"),11605==e.id&&i.find(".options").append("<li>Slam macro with MH swing</li>"),2687==e.id&&i.find(".options").append("<li>Used on cooldown below 80 rage</li>"),void 0!==e.reaction&&i.find(".options").append(`<li><input style="width:25px" type="text" name="reaction" value="${e.reaction}" data-numberonly="true" /> ms reaction time</li>`),e.hidden&&i.addClass("hidden"),"Orc"==localStorage.race&&20572==e.id&&i.removeClass("hidden"),"Troll"==localStorage.race&&26296==e.id&&i.removeClass("hidden"),e.active&&i.addClass("active"),void 0!==e.maincd&&i.find(".options li:first-of-type").append(" or"),void 0!==e.crusaders&&i.find(".options li:first-of-type").append(" or"),11567==e.id&&(i.find(".options").empty(),i.find(".options").append('<li>Queue when above <input type="text" name="minrage" value="30" data-numberonly="true"> rage or BT/MS cooldown >= <input type="text" name="maincd" value="4" data-numberonly="true"> secs</li>'),i.find(".options").append(`<li>Unqueue if below <input type="text" name="unqueue" value="${e.unqueue}" data-numberonly="true" /> rage, <input type="text" name="unqueuetimer" value="${e.unqueuetimer}" data-numberonly="true" /> ms before MH swing</li>`),i.find(".options").append(`<li><input style="width:25px" type="text" name="reaction" value="${e.reaction}" data-numberonly="true" /> ms reaction time</li>`)),115671==e.id&&(i.find(".options").empty(),i.find(".options").before("<label>Execute phase HS:</label>"),i.find(".options").append('<li>Queue when above <input type="text" name="minrage" value="30" data-numberonly="true"> rage</li>'),i.find(".options").append(`<li>Unqueue if below <input type="text" name="unqueue" value="${e.unqueue}" data-numberonly="true" /> rage, <input type="text" name="unqueuetimer" value="${e.unqueuetimer}" data-numberonly="true" /> ms before MH swing</li>`),i.find(".options").append(`<li><input style="width:25px" type="text" name="reaction" value="${e.reaction}" data-numberonly="true" /> ms reaction time</li>`)),11585==e.id&&(i.find(".options").empty(),i.find(".options").append(`<li>Use when below <input type="text" name="maxrage" value="${e.maxrage}" data-numberonly="true" /> rage and</li>`),i.find(".options").append(`<li>BT/MS cooldown >= <input type="text" name="maincd" value="${e.maincd}" data-numberonly="true" /> secs</li>`),i.find(".options").append(`<li><input style="width:25px" type="text" name="reaction" value="${e.reaction}" data-numberonly="true" /> ms reaction time</li>`)),this.rotation.find("div:first").append(i)}this.rotation.children().eq(3).appendTo(this.rotation),this.rotation.children().eq(19).appendTo(this.rotation)},buildBuffs:function(){for(let e of buffs){let t=e.spellid?"spell":"item",i=e.active?"active":"",a=e.group?`data-group="${e.group}"`:"",n=e.disableSpell?`data-disable-spell="${e.disableSpell}"`:"",s=`<div data-id="${e.id}" class="icon ${i}" ${a} ${n}>\n                            <img src="dist/img/${e.iconname.toLowerCase()}.jpg " alt="${e.name}">\n                            <a href="https://database.turtle-wow.org/?${t}=${e.id}" class="wh-tooltip"></a>\n                        </div>`;this.buffs.append(s)}},buildTalents:function(){for(let e of talents){let t=$('<table><tr><th colspan="4">'+e.n+"</th></tr></table>");for(let e=0;e<7;e++)t.prepend("<tr><td></td><td></td><td></td><td></td></tr>");for(let i of e.t){let e=$('<div class="icon" data-count="'+i.c+'" data-x="'+i.x+'" data-y="'+i.y+'"></div>');e.html('<img src="dist/img/'+i.iconname.toLowerCase()+'.jpg" alt="'+i.n+'" />'),i.c>=i.m&&e.addClass("maxed"),i.enable&&0==i.c&&this.rotation.find('[data-id="'+i.enable+'"]').addClass("hidden"),i.enable&&i.c>0&&this.rotation.find('[data-id="'+i.enable+'"]').removeClass("hidden"),e.append('<a href="https://database.turtle-wow.org/?spell='+i.s[0==i.c?0:i.c-1]+'" class="wh-tooltip"></a>'),t.find("tr").eq(i.y).children().eq(i.x).append(e)}this.talents.append(t)}},getTalent:function(e){let t=e.parents("table").index(),i=e.data("x"),a=e.data("y");for(let e of talents[t-1].t)if(e.x==i&&e.y==a)return e}};
