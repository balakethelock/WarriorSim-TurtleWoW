const MAX_WORKERS=navigator.hardwareConcurrency||8;var SIM=SIM||{};SIM.UI={init:function(){this.variables(),this.events(),this.loadSession(),this.loadWeapons("mainhand"),this.updateSidebar(),this.body.on("click",".wh-tooltip, .tablesorter-default a",function(t){t.preventDefault()})},variables:function(){this.body=$("body"),this.buffs=this.body.find("article.buffs"),this.fight=this.body.find("article.fight"),this.rotation=this.body.find("article.rotation"),this.talents=this.body.find("article.talents"),this.filter=this.body.find("article.filter"),this.main=this.body.find("section.main"),this.sidebar=this.body.find("section.sidebar"),this.tcontainer=this.main.find(".table-container"),this.alerts=this.body.find(".alerts"),this.progress=this.main.find("progress")},events:function(){var t=this;t.sidebar.find(".js-settings").click(function(e){e.preventDefault(),$(this).toggleClass("active"),window.scrollTo(0,0),$("section.settings").height(t.body.outerHeight()),$("section.settings").toggleClass("active"),t.sidebar.find(".js-stats").removeClass("active"),$("section.stats").removeClass("active")}),t.sidebar.find(".js-dps").click(function(e){e.preventDefault(),t.disableEditMode(),t.startLoading(),t.simulateDPS()}),t.sidebar.find(".js-weights").click(function(e){e.preventDefault(),t.disableEditMode(),t.startLoading(),t.simulateDPS("stats")}),t.sidebar.find(".js-stats").click(function(e){e.preventDefault(),$(this).toggleClass("active"),$("section.stats").toggleClass("active"),t.sidebar.find(".js-settings").removeClass("active"),$("section.settings").removeClass("active")}),t.body.on("click",".js-table",function(e){e.preventDefault(),t.disableEditMode();const s=t.tcontainer.find("table.gear tbody tr");s.addClass("waiting"),t.tcontainer.find("table.gear tbody tr td:last-of-type").html(""),t.startLoading(),t.simulateDPS(s)}),t.main.on("click",".js-enchant",function(e){e.preventDefault(),t.disableEditMode();const s=t.tcontainer.find("table.enchant tbody tr");s.addClass("waiting"),t.tcontainer.find("table.enchant tbody tr td:last-of-type").html(""),t.startLoading(),t.simulateDPS(s)}),t.main.on("click",".js-editmode",function(e){e.preventDefault(),$(this).toggleClass("active"),window.scrollTo(0,0),$(this).hasClass("active")?t.enableEditMode():t.disableEditMode()}),t.main.find("nav li p").click(function(e){e.preventDefault(),e.stopPropagation();let s=$(this).parent();s.addClass("active"),s.siblings().removeClass("active");var a=s.data("type");a||(a=s.parents("[data-type]").data("type")),"mainhand"==a||"offhand"==a||"twohand"==a?t.loadWeapons(a):"custom"==a?t.loadCustom():t.loadGear(a)}),t.tcontainer.on("click","table.gear td:not(.ppm)",function(e){var s=$(this).parents("table"),a=(s.data("type"),s.data("max")),i=$(this).parent();if(s.hasClass("editmode"))i.hasClass("hidden")?t.rowShowItem(i):t.rowHideItem(i);else{if(i.hasClass("active"))t.rowDisableItem(i);else s.find("tr.active").length>=a&&t.rowDisableItem(s.find("tr.active").last()),t.rowEnableItem(i);t.updateSession(),t.updateSidebar()}}),t.tcontainer.on("click","table.enchant td:not(.ppm)",function(e){var s=$(this).parents("table"),a=$(this).parent(),i=a.data("temp");if(s.hasClass("editmode"))a.hasClass("hidden")?t.rowShowEnchant(a):t.rowHideEnchant(a);else{if(a.hasClass("active"))t.rowDisableEnchant(a);else{let e=s.find('tr.active[data-temp="'+i+'"]').first();e.length&&t.rowDisableEnchant(e),t.rowEnableEnchant(a)}t.updateSession(),t.updateSidebar()}})},enableEditMode:function(){let t=this.tcontainer.find("table.gear").attr("data-type");"mainhand"==t||"offhand"==t||"twohand"==t?this.loadWeapons(t,!0):"custom"==t?this.loadCustom(!0):this.loadGear(t,!0)},disableEditMode:function(){this.main.find(".js-editmode").removeClass("active");let t=this.tcontainer.find("table.gear").attr("data-type");"mainhand"==t||"offhand"==t||"twohand"==t?this.loadWeapons(t,!1):"custom"==t?this.loadCustom(!1):this.loadGear(t,!1)},simulateDPS:function(t){let e=this,s=e.sidebar.find("#dps"),a=e.sidebar.find("#dpserr"),i=e.sidebar.find("#stats"),n=e.sidebar.find("#time"),d=e.sidebar.find(".js-dps"),r="stats"===t;r&&(t=void 0),s.text(""),a.text(""),n.text("");const o={player:[void 0,void 0,void 0,Player.getConfig()],sim:Simulation.getConfig(),fullReport:!0};if(t){let e=t.parents("table").data("type");"finger"!=e&&"trinket"!=e&&"custom"!=e||(o.player=[null,e,void 0,Player.getConfig()])}if(player=new Player(...o.player),!player.mh)return e.addAlert("No weapon selected"),void e.endLoading();var l=new SimulationWorkerParallel(MAX_WORKERS,o=>{const h=o.totaldmg/o.totalduration;s.text(h.toFixed(2));const c=o.sumdps,f=o.sumdps2,u=o.iterations,p=(f-c*c/u)/(u-1)/u;a.text((1.96*Math.sqrt(p)).toFixed(2)),n.text((o.endtime-o.starttime)/1e3),i.html(o.mindps.toFixed(2)+" min&nbsp;&nbsp;&nbsp;&nbsp;"+o.maxdps.toFixed(2)+" max"),d.css("background",""),t?e.simulateRows(Array.from(t)):r?e.simulateWeights(player,h,p):e.endLoading(),SIM.STATS.initCharts(o),l=null,player=null},(t,e)=>{let a=parseInt(t/e.iterations*100);s.text((e.totaldmg/e.totalduration).toFixed(2)),d.css("background","linear-gradient(to right, transparent "+a+"%, #444 "+a+"%)")},t=>{s.text("ERROR"),console.error(t)});l.start(o)},simulateWeights:function(t,e,s){const a=this,i=a.sidebar.find(".js-weights"),n=t.auras.bloodfury?4:3;a.sidebar.find("#weights-div").css("display","block"),a.sidebar.find("#weights-div > div").addClass("loading").append('<span class="spinner"><span class="bounce1"></span><span class="bounce2"></span><span class="bounce3"></span></span>');let d=0;function r(t){const e=parseInt(100*(d+t)/n);i.css("background","linear-gradient(to right, transparent "+e+"%, #444 "+e+"%)")}const o=(t,a)=>this.simulateStat(t,a,r).then(t=>(d+=1,{weight:(t.mean-e)/a,error:1.96*Math.sqrt(s+t.varmean)/a}));function l(t,{weight:e,error:s}){const i=a.sidebar.find("#weight-"+t);i.removeClass("loading").find(".spinner").remove(),i.find(".stat-dps").text(e.toFixed(2)),i.find(".stat-error").text(s.toFixed(2))}(async function(){const e=await o(0,50);if(l("ap",e),console.log(t.auras.bloodfury),t.auras.bloodfury)l("str",await o(3,25));else{const s=2*t.stats.strmod;l("str",{weight:e.weight*s,error:e.error*s})}const s=await o(1,2);l("crit",s);const a=t.stats.agimod/20;l("agi",{weight:s.weight*a,error:s.error*a}),l("hit",await o(2,2)),l("haste",await o(14,2))})().then(()=>{i.css("background",""),a.endLoading()},t=>{i.css("background",""),a.sidebar.find("#dps").text("ERROR"),a.sidebar.find("#dpserr").text(""),a.endLoading(),console.error(t)})},simulateStat:function(t,e,s){return new Promise((a,i)=>{const n={player:[e,t,3,Player.getConfig()],sim:Simulation.getConfig()};new SimulationWorkerParallel(MAX_WORKERS,t=>{const e=t.totaldmg/t.totalduration,s=t.sumdps,i=t.sumdps2,n=t.iterations;a({mean:e,varmean:(i-s*s/n)/(n-1)/n})},(t,e)=>{s&&s(t/e.iterations,e.totaldmg/e.totalduration)},t=>i(t)).start(n)})},simulateRows:function(t){var e=this,s=e.sidebar.find(".js-table");const a=t.map(n=>{const d={perc:0};return d.run=(()=>{i.delete(d),this.simulateRow($(n),n=>{d.perc=n;const r=Math.floor(Array.from(a.values()).map(t=>t.perc).reduce((t,e)=>t+e,0)/t.length);if(100==r?(s.css("background",""),e.endLoading(),e.updateSession()):s.css("background","linear-gradient(to right, transparent "+r+"%, #444 "+r+"%)"),100==d.perc){const t=i.values().next().value;t&&t.run()}})}),d}),i=new Set(a);for(const t of a.slice(0,MAX_WORKERS))t.run()},simulateRow:function(t,e){var s=this,a=t.find("td:last-of-type"),i=t.parents("table").data("type"),n=t.data("id"),d=t.parents("table").hasClass("enchant"),r=1==t.data("temp"),o=parseFloat(s.sidebar.find("#dps").text());const l={player:[n,i,r?2:d?1:0,Player.getConfig()],sim:Simulation.getConfig()};var h=new SimulationWorker(r=>{let l=$("<span></span>"),c=r.totaldmg/r.totalduration,f=c-o;if(l.text(f.toFixed(2)),f>=0?l.addClass("p"):l.addClass("n"),a.text(c.toFixed(2)).append(l),s.tcontainer.find("table").each(function(){if("custom"==i)return;$(this).trigger("update");let t=[[$(this).find("th").length-1,1]];$(this).trigger("sorton",[t])}),t.removeClass("waiting"),e(100),h=null,d)for(let t of enchant[i])t.id==n&&(t.dps=c.toFixed(2));else for(let t of gear[i])t.id==n&&(t.dps=c.toFixed(2))},(t,s)=>{e(Math.floor(t/s.iterations*100)),a.text((s.totaldmg/s.totalduration).toFixed(2))},t=>{a.text("ERROR"),console.error(t)});h.start(l)},rowDisableItem:function(t){var e=t.parents("table").data("type");t.removeClass("active");for(let s=0;s<gear[e].length;s++)gear[e][s].id==t.data("id")&&(gear[e][s].selected=!1)},rowEnableItem:function(t){var e=t.parents("table").data("type");t.addClass("active");for(let s=0;s<gear[e].length;s++)gear[e][s].id==t.data("id")?gear[e][s].selected=!0:"finger"!=e&&"trinket"!=e&&"custom"!=e&&(gear[e][s].selected=!1);if("twohand"==e){for(let t=0;t<gear.mainhand.length;t++)gear.mainhand[t].selected=!1;for(let t=0;t<gear.offhand.length;t++)gear.offhand[t].selected=!1;for(let t=0;t<enchant.mainhand.length;t++)enchant.mainhand[t].selected=!1;for(let t=0;t<enchant.offhand.length;t++)enchant.offhand[t].selected=!1}if("mainhand"==e||"offhand"==e){for(let t=0;t<gear.twohand.length;t++)gear.twohand[t].selected=!1;for(let t=0;t<enchant.twohand.length;t++)enchant.twohand[t].selected=!1}},rowHideItem:function(t){var e=t.parents("table").data("type");t.removeClass("active"),t.addClass("hidden"),t.find(".hide").html(eyesvghidden);for(let s=0;s<gear[e].length;s++)gear[e][s].id==t.data("id")&&(gear[e][s].hidden=!0,gear[e][s].selected=!1)},rowShowItem:function(t){var e=t.parents("table").data("type");t.removeClass("hidden"),t.find(".hide").html(eyesvg);for(let s=0;s<gear[e].length;s++)gear[e][s].id==t.data("id")&&(gear[e][s].hidden=!1)},rowDisableEnchant:function(t){var e=t.parents("table").data("type");t.removeClass("active");for(let s=0;s<enchant[e].length;s++)enchant[e][s].id==t.data("id")&&(enchant[e][s].selected=!1)},rowEnableEnchant:function(t){var e=t.parents("table").data("type");t.addClass("active");for(let s=0;s<enchant[e].length;s++)enchant[e][s].id==t.data("id")&&(enchant[e][s].selected=!0)},rowHideEnchant:function(t){var e=t.parents("table").data("type");t.removeClass("active"),t.addClass("hidden"),t.find(".hide").html(eyesvghidden);for(let s=0;s<enchant[e].length;s++)enchant[e][s].id==t.data("id")&&(enchant[e][s].hidden=!0,enchant[e][s].selected=!1)},rowShowEnchant:function(t){var e=t.parents("table").data("type");t.removeClass("hidden"),t.find(".hide").html(eyesvg);for(let s=0;s<enchant[e].length;s++)enchant[e][s].id==t.data("id")&&(enchant[e][s].hidden=!1)},startLoading:function(){let t=$(".js-dps, .js-weights, .js-table, .js-enchant");t.addClass("loading"),t.append('<span class="spinner"><span class="bounce1"></span><span class="bounce2"></span><span class="bounce3"></span></span>'),$("section.main nav").addClass("loading")},endLoading:function(){let t=$(".js-dps, .js-weights, .js-table, .js-enchant");t.removeClass("loading"),t.find(".spinner").remove(),$("section.main nav").removeClass("loading")},updateSidebar:function(){var t=new Player;let e="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";if(!t.mh)return;this.sidebar.find("#str").text(t.stats.str),this.sidebar.find("#agi").text(t.stats.agi),this.sidebar.find("#ap").text(t.stats.ap),this.sidebar.find("#skill").html(t.stats["skill_"+t.mh.type]+" <small>MH</small>"+(t.oh?e+t.stats["skill_"+t.oh.type]+" <small>OH</small>":"")),this.sidebar.find("#hit").html((t.stats.hit||0)+"%"),this.sidebar.find("#miss").html(Math.max(t.mh.miss,0).toFixed(2)+"% <small>1H</small>"+(t.oh?e+Math.max(t.mh.dwmiss,0).toFixed(2)+"% <small>DW</small>":""));let s=t.crit+t.mh.crit,a=t.crit+(t.oh?t.oh.crit:0);this.sidebar.find("#crit").html(s.toFixed(2)+"% <small>MH</small>"+(t.oh?e+a.toFixed(2)+"% <small>OH</small>":""));let i=100-t.mh.dwmiss-t.mh.dodge-t.mh.glanceChance,n=t.oh?100-t.oh.dwmiss-t.oh.dodge-t.oh.glanceChance:0;this.sidebar.find("#critcap").html(i.toFixed(2)+"% <small>MH</small>"+(t.oh?e+n.toFixed(2)+"% <small>OH</small>":""));let d=t.stats.dmgmod*t.mh.modifier*100,r=t.stats.dmgmod*(t.oh?100*t.oh.modifier:0);this.sidebar.find("#dmgmod").html(d.toFixed(2)+"% <small>MH</small>"+(t.oh?e+r.toFixed(2)+"% <small>OH</small>":"")),this.sidebar.find("#arp").html(t.stats.arp+"/"+t.target.basearmor+" <small>ArP</small>"+e+"+"+(100*t.arpContribution).toFixed(2)+"% <small>DPS</small>"),this.sidebar.find("#haste").html((100*t.stats.haste).toFixed(2)+"%"),this.sidebar.find("#shadow-resist").html(t.stats.resist.shadow),this.sidebar.find("#arcane-resist").html(t.stats.resist.arcane),this.sidebar.find("#nature-resist").html(t.stats.resist.nature),this.sidebar.find("#fire-resist").html(t.stats.resist.fire),this.sidebar.find("#frost-resist").html(t.stats.resist.frost),this.sidebar.find("#race").text(localStorage.race),this.sidebar.find("#sets").empty();for(let e of sets){let s=0;for(let a of e.items)t.items.includes(a)&&s++;0!=s&&(s>=e.bonus[0].count&&this.sidebar.find("#sets").append(`<a href="https://classic.wowhead.com/item-set=${e.id}" class="q4">${e.name} (${s})</a><br />`))}},updateSession:function(){localStorage.level=this.fight.find('input[name="level"]').val(),localStorage.race=this.fight.find('select[name="race"]').val(),localStorage.simulations=this.fight.find('input[name="simulations"]').val(),localStorage.timesecsmin=this.fight.find('input[name="timesecsmin"]').val(),localStorage.timesecsmax=this.fight.find('input[name="timesecsmax"]').val(),localStorage.executeperc=this.fight.find('input[name="executeperc"]').val(),localStorage.startrage=this.fight.find('input[name="startrage"]').val(),localStorage.targetlevel=this.fight.find('select[name="targetlevel"]').val(),localStorage.targetarmor=this.fight.find('input[name="targetarmor"]').val(),localStorage.targetresistance=this.fight.find('input[name="targetresistance"]').val(),localStorage.adjacent=this.fight.find('input[name="adjacent"]').val(),localStorage.adjacentlevel=this.fight.find('input[name="adjacentlevel"]').val(),localStorage.aqbooks=this.fight.find('select[name="aqbooks"]').val(),localStorage.weaponrng=this.fight.find('select[name="weaponrng"]').val(),localStorage.spelldamage=this.fight.find('input[name="spelldamage"]').val(),localStorage.batching=this.fight.find('select[name="batching"]').val();let t=[],e=[],s=[],a=[],i=[],n={},d={},r={};this.buffs.find(".active").each(function(){t.push($(this).attr("data-id"))}),this.filter.find(".sources .active").each(function(){a.push($(this).attr("data-id"))}),this.filter.find(".phases .active").each(function(){i.push($(this).attr("data-id"))});for(let t of talents){let e=[];for(let s of t.t)e.push(s.c);s.push({n:t.n,t:e})}this.rotation.find(".spell").each(function(){var t={};t.id=$(this).attr("data-id"),t.active=$(this).hasClass("active"),$(this).find("input").each(function(){t[$(this).attr("name")]=$(this).val()}),e.push(t)});for(let t in gear){n[t]=[];for(let e of gear[t])n[t].push({id:e.id,selected:e.selected,dps:e.dps,hidden:e.hidden})}for(let t in enchant){d[t]=[];for(let e of enchant[t])d[t].push({id:e.id,selected:e.selected,dps:e.dps,hidden:e.hidden})}var o=["shadow","arcane","nature","fire","frost"];for(let t in o){var l=o[t];r[l]=$(".resistances[data-id='"+l+"-resist']").prop("checked")}localStorage.buffs=JSON.stringify(t),localStorage.rotation=JSON.stringify(e),localStorage.sources=JSON.stringify(a),localStorage.phases=JSON.stringify(i),localStorage.talents=JSON.stringify(s),localStorage.gear=JSON.stringify(n),localStorage.enchant=JSON.stringify(d),localStorage.resistances=JSON.stringify(r)},loadSession:function(){localStorage.length||this.firstSession();for(let t in localStorage)this.fight.find('input[name="'+t+'"]').val(localStorage[t]),this.fight.find('select[name="'+t+'"]').val(localStorage[t]);this.sidebar.find(".bg").attr("data-race",this.fight.find('select[name="race"]').val()),updateGlobals({talents:localStorage.talents?JSON.parse(localStorage.talents):JSON.parse(session.talents),buffs:localStorage.buffs?JSON.parse(localStorage.buffs):JSON.parse(session.buffs),rotation:localStorage.rotation?JSON.parse(localStorage.rotation):JSON.parse(session.rotation),gear:localStorage.gear?JSON.parse(localStorage.gear):JSON.parse(session.gear),enchant:localStorage.enchant?JSON.parse(localStorage.enchant):JSON.parse(session.enchant),resistances:localStorage.resistances?JSON.parse(localStorage.resistances):null});let t=localStorage.sources?JSON.parse(localStorage.sources):JSON.parse(session.sources),e=localStorage.phases?JSON.parse(localStorage.phases):JSON.parse(session.phases);for(let e of t)this.filter.find(`.sources [data-id="${e}"]`).addClass("active");for(let t of e)this.filter.find(`.phases [data-id="${t}"]`).addClass("active");(!localStorage.version||parseInt(localStorage.version)<version)&&this.newVersion();var s=["shadow","arcane","nature","fire","frost"];for(let t in s){var a=s[t];$(".resistances[data-id='"+a+"-resist']").prop("checked")&&this.sidebar.find("."+a+"-resist.hidden").removeClass("hidden")}},filterGear:function(){var t=this.main.find("nav > ul > li.active").data("type");"mainhand"==t||"offhand"==t?this.loadWeapons(t):"custom"==t?this.loadCustom():this.loadGear(t)},loadWeapons:function(t,e){var s=this.main.find("nav li.active .filter .active").text(),a=SIM.UI.resistCheckList();let i=`<table class="gear ${e?"editmode":""}" data-type="${t}" data-max="1">\n                        <thead>\n                            <tr>\n                                ${e?"<th></th>":""}\n                                <th>Name</th>\n                                <th>Source</th>\n                                <th>Sta</th>\n                                <th>Str</th>\n                                <th>Agi</th>\n                                <th>AP</th>\n                                <th>ArP</th>\n                                <th>Crit</th>\n                                <th>Hit</th>\n                                <th class="shadow-resist ${a.shadow?"":"hidden"}">Shadow Resist</th>\n                                <th class="arcane-resist ${a.arcane?"":"hidden"}">Arcane Resist</th>\n                                <th class="nature-resist ${a.nature?"":"hidden"}">Nature Resist</th>\n                                <th class="fire-resist ${a.fire?"":"hidden"}">Fire Resist</th>\n                                <th class="frost-resist ${a.frost?"":"hidden"}">Frost Resist</th>\n                                <th>Haste</th>\n                                <th>Min</th>\n                                <th>Max</th>\n                                <th>Speed</th>\n                                <th>Skill</th>\n                                <th>Type</th>\n                                <th>PPM</th>\n                                <th>DPS</th>\n                            </tr>\n                        </thead>\n                    <tbody>`;for(let n of gear[t]){if(s&&"All"!=s)if("Mace & Sword"==s){if("Mace"!=n.type&&"Sword"!=n.type)continue}else if("Axe, Dagger & Sword"==s){if("Axe"!=n.type&&"Dagger"!=n.type&&"Sword"!=n.type)continue}else if(n.type!=s)continue;let t=n.source.toLowerCase(),d=n.phase;if("Lethon"!=n.source&&"Emeriss"!=n.source&&"Kazzak"!=n.source&&"Azuregos"!=n.source&&"Ysondre"!=n.source&&"Taerar"!=n.source&&"Green Dragons"!=n.source&&"Nerubian"!=n.source&&"Dark Reaver"!=n.source&&"Concavius"!=n.source&&"Ostarius"!=n.source||(t="worldboss"),"shadow"!=n.subsource&&"arcane"!=n.subsource&&"nature"!=n.subsource&&"fire"!=n.subsource&&"frost"!=n.subsource||(t="resistances-list"),d&&!this.filter.find('.phases [data-id="'+d+'"]').hasClass("active"))continue;if(t&&!this.filter.find('.sources [data-id="'+t+'"]').hasClass("active"))continue;if(n.hidden&&!e)continue;let r=n.id,o="";199211==r&&(r=19921),n.rand&&(o="?rand="+n.rand),i+=`<tr data-id="${n.id}" data-name="${n.name}" class="${n.selected?"active":""} ${n.hidden?"hidden":""}">\n                        ${e?'<td class="hide">'+(n.hidden?eyesvghidden:eyesvg)+"</td>":""}\n                        <td><a href="https://database.turtle-wow.org/?item=${r}${o}"></a>${n.name}</td>`,i+=`<td>${n.source}</td>\n                        <td>${n.sta||""}</td>\n                        <td>${n.str||""}</td>\n                        <td>${n.agi||""}</td>\n                        <td>${n.ap||""}</td>\n                        <td>${n.arp||n.arpv||""}</td>\n                        <td>${n.crit||""}</td>\n                        <td>${n.hit||""}</td>\n                        <td class="shadow-resist ${a.shadow?"":"hidden"}">${(n.resist||{}).shadow||""}</td>\n                        <td class="arcane-resist ${a.arcane?"":"hidden"}">${(n.resist||{}).arcane||""}</td>\n                        <td class="nature-resist ${a.nature?"":"hidden"}">${(n.resist||{}).nature||""}</td>\n                        <td class="fire-resist ${a.fire?"":"hidden"}">${(n.resist||{}).fire||""}</td>\n                        <td class="frost-resist ${a.frost?"":"hidden"}">${(n.resist||{}).frost||""}</td>\n                        <td>${n.haste||""}</td>\n                        <td>${n.mindmg||""}</td>\n                        <td>${n.maxdmg||""}</td>\n                        <td>${n.speed||""}</td>\n                        <td>${n.skill||""}</td>\n                        <td>${n.type||""}</td>\n                        <td class="ppm"><p contenteditable="true">${n.ppm||""}</p></td>\n                        <td>${n.dps||""}</td>\n                    </tr>`}i+="</tbody></table></section>",this.tcontainer.empty(),this.tcontainer.append(i),this.tcontainer.find("table.gear").tablesorter({widthFixed:!0,sortList:e?[[17,1],[1,0]]:[[16,1],[0,0]],textSorter:{16:function(t,e,s,a,i){t=parseFloat(t.substring(0,t.indexOf(".")+3)),e=parseFloat(e.substring(0,e.indexOf(".")+3));return isNaN(t)&&(t=0),isNaN(e)&&(e=0),t<e?-1:t>e?1:0}},headers:{16:{sorter:"text"}}}),this.loadEnchants(t,e)},resistCheckList:function(){return{shadow:$(".resistances[data-id='shadow-resist']").prop("checked"),arcane:$(".resistances[data-id='arcane-resist']").prop("checked"),nature:$(".resistances[data-id='nature-resist']").prop("checked"),fire:$(".resistances[data-id='fire-resist']").prop("checked"),frost:$(".resistances[data-id='frost-resist']").prop("checked")}},loadGear:function(t,e){let s=`<table class="gear ${e?"editmode":""}" data-type="${t}" data-max="1">\n                        <thead>\n                            <tr>\n                                ${e?"<th></th>":""}\n                                <th>Name</th>\n                                <th>Source</th>\n                                <th>Sta</th>\n                                <th>Str</th>\n                                <th>Agi</th>\n                                <th>AP</th>\n                                <th>ArP</th>\n                                <th>Hit</th>\n                                <th>Crit</th>\n                                <th class="shadow-resist ${(a=SIM.UI.resistCheckList()).shadow?"":"hidden"}">Shadow Resist</th>\n                                <th class="arcane-resist ${a.arcane?"":"hidden"}">Arcane Resist</th>\n                                <th class="nature-resist ${a.nature?"":"hidden"}">Nature Resist</th>\n                                <th class="fire-resist ${a.fire?"":"hidden"}">Fire Resist</th>\n                                <th class="frost-resist ${a.frost?"":"hidden"}">Frost Resist</th>\n                                <th>Haste</th>\n                                <th>Skill</th>\n                                <th>Type</th>\n                                <th>DPS</th>\n                            </tr>\n                        </thead>\n                    <tbody>`;for(let i of gear[t]){let t=i.source.toLowerCase(),n=i.phase;if("Lethon"!=i.source&&"Emeriss"!=i.source&&"Kazzak"!=i.source&&"Azuregos"!=i.source&&"Ysondre"!=i.source&&"Taerar"!=i.source&&"Green Dragons"!=i.source&&"Nerubian"!=i.source&&"Dark Reaver"!=i.source&&"Concavius"!=i.source&&"Ostarius"!=i.source||(t="worldboss"),"shadow"!=i.subsource&&"arcane"!=i.subsource&&"nature"!=i.subsource&&"fire"!=i.subsource&&"frost"!=i.subsource||(t="resistances-list"),n&&!this.filter.find('.phases [data-id="'+n+'"]').hasClass("active"))continue;if(t&&!this.filter.find('.sources [data-id="'+t+'"]').hasClass("active"))continue;if("resistances-list"===t&&!$(".resistances[data-id='"+i.subsource+"-resist']").prop("checked"))continue;if(i.hidden&&!e)continue;let d=i.id,r="";145541==d&&(d=14554),198981==d&&(d=19898),i.rand&&(r="?rand="+i.rand),s+=`<tr data-id="${i.id}" class="${i.selected?"active":""} ${i.hidden?"hidden":""}">\n                        ${e?'<td class="hide">'+(i.hidden?eyesvghidden:eyesvg)+"</td>":""}\n\n                        <td><a href="https://database.turtle-wow.org/?item=${d}${r}"></a>${i.name}</td>`;var a=SIM.UI.resistCheckList();s+=`<td>${i.source||""}</td>\n                        <td>${i.sta||""}</td>\n                        <td>${i.str||""}</td>\n                        <td>${i.agi||""}</td>\n                        <td>${i.ap||""}</td>\n                        <td>${i.arp||i.arpv||""}</td>\n                        <td>${i.hit||""}</td>\n                        <td>${i.crit||""}</td>\n                        <td class="shadow-resist ${a.shadow?"":"hidden"}">${(i.resist||{}).shadow||""}</td>\n                        <td class="arcane-resist ${a.arcane?"":"hidden"}">${(i.resist||{}).arcane||""}</td>\n                        <td class="nature-resist ${a.nature?"":"hidden"}">${(i.resist||{}).nature||""}</td>\n                        <td class="fire-resist ${a.fire?"":"hidden"}">${(i.resist||{}).fire||""}</td>\n                        <td class="frost-resist ${a.frost?"":"hidden"}">${(i.resist||{}).frost||""}</td>\n                        <td>${i.haste||""}</td>\n                        <td>${i.skill||""}</td>\n                        <td>${i.type||""}</td>\n                        <td>${i.dps||""}</td>\n                    </tr>`}s+="</tbody></table></section>",this.tcontainer.empty(),this.tcontainer.append(s),this.tcontainer.find("table.gear").tablesorter({widthFixed:!0,sortList:e?[[13,1],[1,0]]:[[12,1],[0,0]],textSorter:{12:function(t,e,s,a,i){t=parseFloat(t.substring(0,t.indexOf(".")+3)),e=parseFloat(e.substring(0,e.indexOf(".")+3));return isNaN(t)&&(t=0),isNaN(e)&&(e=0),t<e?-1:t>e?1:0}},headers:{12:{sorter:"text"}}}),this.loadEnchants(t,e),this.updateSession(),this.updateSidebar()},loadCustom:function(t){var e=SIM.UI.resistCheckList();let s=`<table class="gear ${t?"editmode":""}" data-type="custom" data-max="10">\n                        <thead>\n                            <tr>\n                                ${t?"<th></th>":""}\n                                <th>Name</th>\n                                <th>Str</th>\n                                <th>Agi</th>\n                                <th>AP</th>\n                                <th>ArP</th>\n                                <th>Hit</th>\n                                <th>Crit</th>\n                                <th class="shadow-resist ${e.shadow?"":"hidden"}">Shadow Resist</th>\n                                <th class="arcane-resist ${e.arcane?"":"hidden"}">Arcane Resist</th>\n                                <th class="nature-resist ${e.nature?"":"hidden"}">Nature Resist</th>\n                                <th class="fire-resist ${e.fire?"":"hidden"}">Fire Resist</th>\n                                <th class="frost-resist ${e.frost?"":"hidden"}">Frost Resist</th>\n                                <th>Haste</th>\n                                <th>Skill</th>\n                                <th>DPS</th>\n                            </tr>\n                        </thead>\n                    <tbody>`;for(let a of gear.custom)a.hidden&&!t||(s+=`<tr data-id="${a.id}" class="${a.selected?"active":""} ${a.hidden?"hidden":""}">\n                        ${t?'<td class="hide">'+(a.hidden?eyesvghidden:eyesvg)+"</td>":""}\n                        <td>${a.name}</td>\n                        <td>${a.str||""}</td>\n                        <td>${a.agi||""}</td>\n                        <td>${a.ap||""}</td>\n                        <td>${a.arp||""}</td>\n                        <td>${a.hit||""}</td>\n                        <td>${a.crit||""}</td>\n                        <td class="shadow-resist ${e.shadow?"":"hidden"}">${(a.resist||{}).shadow||""}</td>\n                        <td class="arcane-resist ${e.arcane?"":"hidden"}">${(a.resist||{}).arcane||""}</td>\n                        <td class="nature-resist ${e.nature?"":"hidden"}">${(a.resist||{}).nature||""}</td>\n                        <td class="fire-resist ${e.fire?"":"hidden"}">${(a.resist||{}).fire||""}</td>\n                        <td class="frost-resist ${e.frost?"":"hidden"}">${(a.resist||{}).frost||""}</td>\n                        <td>${a.haste||""}</td>\n                        <td>${a.skill_1||""}</td>\n                        <td>${a.dps||""}</td>\n                    </tr>`);s+="</tbody></table></section>",this.tcontainer.empty(),this.tcontainer.append(s),this.tcontainer.find("table.gear").tablesorter({widthFixed:!0,sortList:t?[[10,1]]:[[9,1]],headers:{9:{sorter:"text"}}})},loadEnchants:function(t,e){if(this.main.find(".js-enchant").hide(),!enchant[t]||0==enchant[t].length)return;var s=SIM.UI.resistCheckList();let a=`<table class="enchant ${e?"editmode":""}" data-type="${t}" data-max="1">\n                        <thead>\n                            <tr>\n                                ${e?"<th></th>":""}\n                                <th>Enchant</th>\n                                <th>Str</th>\n                                <th>Agi</th>\n                                <th>AP</th>\n                                <th>ArP</th>\n                                <th>Haste</th>\n                                <th class="shadow-resist ${s.shadow?"":"hidden"}">Shadow Resist</th>\n                                <th class="arcane-resist ${s.arcane?"":"hidden"}">Arcane Resist</th>\n                                <th class="nature-resist ${s.nature?"":"hidden"}">Nature Resist</th>\n                                <th class="fire-resist ${s.fire?"":"hidden"}">Fire Resist</th>\n                                <th class="frost-resist ${s.frost?"":"hidden"}">Frost Resist</th>\n                                <th>Crit</th>\n                                <th>Damage</th>\n                                <th>PPM</th>\n                                <th>DPS</th>\n                            </tr>\n                        </thead>\n                    <tbody>`;for(let i of enchant[t])i.phase&&!this.filter.find('.phases [data-id="'+i.phase+'"]').hasClass("active")||i.hidden&&!e||(a+=`<tr data-id="${i.id}" data-temp="${i.temp||!1}" class="${i.selected?"active":""} ${i.hidden?"hidden":""}">\n                        ${e?'<td class="hide">'+(i.hidden?eyesvghidden:eyesvg)+"</td>":""}\n                        <td><a href="https://database.turtle-wow.org/?${i.spellid?"spell":"item"}=${i.id}"></a>${i.name}</td>\n                        <td>${i.str||""}</td>\n                        <td>${i.agi||""}</td>\n                        <td>${i.ap||""}</td>\n                        <td>${i.arp||""}</td>\n                        <td>${i.haste||""}</td>\n                        <td class="shadow-resist ${s.shadow?"":"hidden"}">${(i.resist||{}).shadow||""}</td>\n                        <td class="arcane-resist ${s.arcane?"":"hidden"}">${(i.resist||{}).arcane||""}</td>\n                        <td class="nature-resist ${s.nature?"":"hidden"}">${(i.resist||{}).nature||""}</td>\n                        <td class="fire-resist ${s.fire?"":"hidden"}">${(i.resist||{}).fire||""}</td>\n                        <td class="frost-resist ${s.frost?"":"hidden"}">${(i.resist||{}).frost||""}</td>\n                        <td>${i.crit||""}</td>\n                        <td>${i.dmg||""}</td>\n                        <td>${i.ppm||""}</td>\n                        <td>${i.dps||""}</td>\n                    </tr>`);a+="</tbody></table></section>",0!=$(a).find("tbody tr").length&&(this.tcontainer.append(a),this.tcontainer.find("table.enchant").tablesorter({widthFixed:!0,sortList:e?[[10,1]]:[[9,1]],headers:{9:{sorter:"text"}}}),this.main.find(".js-enchant").show())},addAlert:function(t){var e=this;e.alerts.empty().append('<div class="alert"><p>'+t+"</p></div>"),e.alerts.find(".alert").click(function(){e.closeAlert()}),setTimeout(function(){e.alerts.find(".alert").addClass("in-up")}),setTimeout(function(){e.closeAlert()},4e3)},closeAlert:function(){var t=this;t.alerts.find(".alert").removeClass("in-up"),setTimeout(function(){t.alerts.empty()},1e3)},firstSession:function(){console.log("Welcome!")},newVersion:function(){var t=this;localStorage.version=version,t.filter.find('.phases [data-id="4"]').hasClass("active")||setTimeout(()=>{t.filter.find('.phases [data-id="4"]').click()},100),t.filter.find('.phases [data-id="5"]').hasClass("active")||setTimeout(()=>{t.filter.find('.phases [data-id="5"]').click()},100)}};var eyesvg='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M15 12c0 1.654-1.346 3-3 3s-3-1.346-3-3 1.346-3 3-3 3 1.346 3 3zm9-.449s-4.252 8.449-11.985 8.449c-7.18 0-12.015-8.449-12.015-8.449s4.446-7.551 12.015-7.551c7.694 0 11.985 7.551 11.985 7.551zm-7 .449c0-2.757-2.243-5-5-5s-5 2.243-5 5 2.243 5 5 5 5-2.243 5-5z"/></svg>',eyesvghidden='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M11.885 14.988l3.104-3.098.011.11c0 1.654-1.346 3-3 3l-.115-.012zm8.048-8.032l-3.274 3.268c.212.554.341 1.149.341 1.776 0 2.757-2.243 5-5 5-.631 0-1.229-.13-1.785-.344l-2.377 2.372c1.276.588 2.671.972 4.177.972 7.733 0 11.985-8.449 11.985-8.449s-1.415-2.478-4.067-4.595zm1.431-3.536l-18.619 18.58-1.382-1.422 3.455-3.447c-3.022-2.45-4.818-5.58-4.818-5.58s4.446-7.551 12.015-7.551c1.825 0 3.456.426 4.886 1.075l3.081-3.075 1.382 1.42zm-13.751 10.922l1.519-1.515c-.077-.264-.132-.538-.132-.827 0-1.654 1.346-3 3-3 .291 0 .567.055.833.134l1.518-1.515c-.704-.382-1.496-.619-2.351-.619-2.757 0-5 2.243-5 5 0 .852.235 1.641.613 2.342z"/></svg>';
